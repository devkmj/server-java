# 🛠 조회 성능 개선을 위한 캐싱 전략 & 부하 테스트 보고서

> **💽 Cache (STEP 12)**  
> 트래픽이 많은 API 또는 고비용 조회 로직에 대해 **캐시를 적용**하여 성능을 개선한 보고서 입니다.

---

## 1. 배경 및 문제 정의

### 문제 배경

- 메인 페이지 인기 상품 영역은 전체 트래픽 중 높은 비율을 차지하며, 사용자 요청 대부분이 동일한 조회 로직 반복
- 해당 기능은 최근 3일간 결제 완료 주문 기준 상위 5개 상품을 집계하며 고비용 쿼리를 포함

### 문제점

- **DB 부하 증가**: 순간 트래픽 급증 시 반복 쿼리로 RDBMS 성능 저하
- **응답 지연**: 캐시 미적용 시 평균 응답 11ms 이상 → 사용자 체감 지연
- **SLA 위협**: 실시간 집계가 반복되며 응답 실패율 증가 가능

---

## 2. 개선 목표

- 고트래픽 조회 API의 병목 제거
- 캐시 적용 방식 및 TTL 설계를 통해 성능 최적화 
- 안정적 SLA (응답속도, 성공률) 확보

---

## 3. 인기 상품 노출 정책 요약

| 항목               | 내용 |
|--------------------|------|
| **노출 위치**      | 메인 페이지 – 인기 상품 영역 |
| **노출 상품 수**   | 상위 5개 |
| **집계 기준**      | 최근 3일간 결제 완료(PAID) 주문 수량 |
| **정렬 기준**      | 판매량 desc → 동일 시 최근 판매일 기준 정렬 |
| **재고 품절 상품** | 노출 가능 (단, "일시 품절" 뱃지 표시) |
| **갱신 주기**      | 1분마다 갱신 |
| **데이터 소스**    | `product_sales_summary` 테이블 |
| **제외 조건**      | 사내 계정, 이벤트 주문, 삭제 상품 제외 |

---

## 4. 캐싱 전략 설계

### 1) 적용 방식

- **패턴**: Cache-Aside (Lazy Loading)
- **구현**: Spring `@Cacheable("top5Last3d")` 사용
- **미스 시 처리**: Redis 미스 시 DB 조회 → Redis 저장
- **장점**: TTL 조절 및 캐시 제어 유연성 확보

### 2) Expiration / Eviction

| 항목             | 설정 값 |
|------------------|----------|
| **인기상품 TTL** | 1분 |
| **기본 TTL**     | 5분 |
| **Null 캐싱**    | 비활성화 (`disableCachingNullValues()`) |
| **Eviction**     | Redis 기본 (LRU) 정책 사용 |


---

## 5. 부하 테스트 결과 (K6)

### 실행 환경

- Java 17 / Spring Boot 3.2
- Redis 7 (Docker)
- MySQL 8
- K6 

### 테스트 결과

| 항목             | AS-IS (캐시 미적용) | TO-BE (캐시 적용) |
|------------------|----------------------|--------------------|
| 평균 응답시간     | 11ms                | **7ms**           |
| 95% 응답시간      | 190ms               | **37ms**          |
| 요청 실패율       | 0.04%               | **0.00%**         |
| 처리량            | 10 req/s            | **90 req/s**      |
| 캐시 히트율       | 0%                  | **92%+**          |

---

## 7. 제한점 및 고려사항

- TTL 내 갱신 지연 → **데이터 최신성 보장 어려움**
- 품절/삭제 상태 반영 시점 지연 발생
- 향후 실시간성이 중요한 데이터는 **Pub/Sub 또는 이벤트 기반 캐시 갱신 전략** 고려 필요

---

##  8. 결론

- 인기 상품 조회는 **조회 빈도는 높지만, 실시간성이 크게 중요하지 않은 도메인**으로 캐시 적합
- Cache-Aside 기반 TTL 캐싱을 통해 DB 부하 감소, 응답 속도 향상, 시스템 안정성 확보

---
 